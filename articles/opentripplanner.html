<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>opentripplanner: getting started • opentripplanner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="opentripplanner: getting started">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">opentripplanner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/opentripplanner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_features.html">Advanced Features</a>
    </li>
    <li>
      <a href="../articles/prerequisites.html">Prerequisites</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ITSLeeds/opentripplanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>opentripplanner: getting started</h1>
                        <h4 class="author">Marcus Young, modified by Malcolm Morgan and Robin Lovelace</h4>
            
            <h4 class="date">2019-04-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ITSLeeds/opentripplanner/blob/master/vignettes/opentripplanner.Rmd"><code>vignettes/opentripplanner.Rmd</code></a></small>
      <div class="hidden name"><code>opentripplanner.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette is an introduction to OpenTripPlanner (OTP) - an open-source and cross-platform multi-modal route planner written in JAVA. It uses imported Open Street Map (OSM) data for routing on the street and path network and supports multi-agency public transport routing through imported GTFS feeds. It can also apply a digital elevation model to the OSM street network, allowing, for example, cycle-friendly routes to be requested. OTP has a web front-end that can be used by end-users and a sophisticated routing API.</p>
<p>A major advantage of running your own multi-modal route planner is the ability to carry out analysis using amended transport data. Services such as Google Maps or TransportAPI are based on current public transport schedules and the existing road network. OTP enables you to modify transit schedules and/or make changes to the underlying street network. By editing a local copy of OSM, you can model the effects of opening new roads, closing roads, or imposing other restrictions. You can also look back in time. For example, you might want to examine the effect of reductions in rural bus services on the accessibility of health facilities. To do this you would need a network with bus schedules as they were in previous years.</p>
</div>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>You will need to have installed R, RStudio, and Java 8. For more details on the software required see the <a href="https://itsleeds.github.io/opentripplanner/articles/opentripplanner.html">prerequisites vignette</a> included with this package.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The following commands will install and attach the package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"ITSLeeds/opentripplanner"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(opentripplanner)</a></code></pre></div>
<p>Before you can use the package, you should set-up the OpenTripPlanner Java program. You will need to download the latest version of OTP from <a href="https://repo1.maven.org/maven2/org/opentripplanner/otp/" class="uri">https://repo1.maven.org/maven2/org/opentripplanner/otp/</a> , at time of writing the latest version of OTP is version 1.3 so you would want to get <a href="https://repo1.maven.org/maven2/org/opentripplanner/otp/1.3.0/otp-1.3.0-shaded.jar" class="uri">https://repo1.maven.org/maven2/org/opentripplanner/otp/1.3.0/otp-1.3.0-shaded.jar</a></p>
<p>The following code downloads the file into a folder called <code>programs</code> in your home directory on Linux/Mac or to the Public folder on Windows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># download file (may want to do this manually)</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">path_otp &lt;-<span class="st"> "~/programs/otp.jar"</span> <span class="co"># On Linux/Mac</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">path_otp &lt;-<span class="st"> "C:/Users/Public/otp.jar"</span> <span class="co"># On Windows</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">url_otp &lt;-<span class="st"> "https://repo1.maven.org/maven2/org/opentripplanner/otp/1.3.0/otp-1.3.0-shaded.jar"</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="dt">url =</span> url_otp, <span class="dt">destfile =</span> path_otp, <span class="dt">mode=</span><span class="st">"wb"</span>)</a></code></pre></div>
<p>For more information and advanced options, see <a href="http://docs.opentripplanner.org/en/latest/Getting-OTP/" class="uri">http://docs.opentripplanner.org/en/latest/Getting-OTP/</a></p>
</div>
<div id="building-an-otp-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#building-an-otp-graph" class="anchor"></a>Building an OTP Graph</h2>
<p>We will build an example graph for the Isle of Wight using some example data provided for the package. A graph is what OTP uses to find routes, and must be built out of the raw data provided. First we will download the sample data and put it in the folder structure that OTP expects.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Path to the sample data</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">path_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>() <span class="co"># find the current working directory</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.create</a></span>(<span class="st">"graphs"</span>) <span class="co"># create a folder structure for the data</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.create</a></span>(<span class="st">"graphs/default"</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># Download example data</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="st">"https://github.com/ITSLeeds/opentripplanner/releases/download/0.1/isle-of-wight-demo.zip"</span>, </a>
<a class="sourceLine" id="cb3-7" data-line-number="7">              <span class="dt">destfile =</span> <span class="st">"isle-of-wight-demo.zip"</span>, <span class="dt">mode=</span><span class="st">"wb"</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"isle-of-wight-demo.zip"</span>, <span class="dt">exdir =</span> <span class="st">"graphs/default"</span>)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlink">unlink</a></span>(<span class="st">"isle-of-wight-demo.zip"</span>)</a></code></pre></div>
<p>Now we can build the graph. This code will create a new file <code>Graph.obj</code> that will be saved in the location defined by <code>path_data</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Run the OTP and Build a graph object</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">log &lt;-<span class="st"> </span><span class="kw"><a href="../reference/otp_build_graph.html">otp_build_graph</a></span>(<span class="dt">otp =</span> path_otp, <span class="dt">dir =</span> path_data) </a></code></pre></div>
<div id="building-your-own-otp-graph" class="section level3">
<h3 class="hasAnchor">
<a href="#building-your-own-otp-graph" class="anchor"></a>Building your own OTP Graph</h3>
<p>If you want to build your own graph for a different location follow these steps, and change your <code>path_data</code> variable to the folder with your data.</p>
<p>An OTP graph specifies every location in the region covered and how to travel between them, and is compiled by OTP using OSM data for the street and path network (used for walk, bicycle and drive modes) and GTFS data for transit scheduling.</p>
<p>Our first task is to create the folder and file structure expected by OTP. This is a base directory called <code>otp</code> which contains a sub-directory called <code>graphs</code>. Directories created under <code>graphs</code> are known as OTP routers and contain all the files required to build a graph. A single OTP instance can host several routers, for example covering different regions.</p>
<p>Create a router called ‘default’, and include the GTFS and OSM files for the road network and default transit schedules for the railway on the Isle of Wight, along with <code>router-config.json</code>, as shown below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">/</span> otp                         # Your top folder for storing all OTP data</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="ex">/graphs</span>                     </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">     <span class="ex">/default</span>                 # Subfolder with the name of the router</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">         <span class="ex">osm.pbf</span>              # Required OSM road map</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">         <span class="ex">router-config.json</span>   # Optional config file</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">         <span class="ex">build-config.json</span>    # Optional config file</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">         <span class="ex">gtfs.zip</span>             # Optional GTFS data</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">         <span class="ex">dem.tif</span>              # Optional Elevation data</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">         </a></code></pre></div>
<p><code>router-config.json</code> is actually read when the OTP server is started (in the next section), but we add it now for convenience.</p>
</div>
</div>
<div id="launch-otp-and-load-the-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#launch-otp-and-load-the-graph" class="anchor"></a>Launch OTP and load the graph</h2>
<p>The next step is to start up your OTP server, running the router called ‘default’. OTP will load the graph you created into memory and you will then be able to plan multi-modal routes using the web interface. Run the following command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/otp_setup.html">otp_setup</a></span>(<span class="dt">otp =</span> path_otp, <span class="dt">dir =</span> path_data)</a></code></pre></div>
<p>OTP has a built-in web server called Grizzly which runs on port 8080 (http) and 8081 (https). If you have another application running on your computer that uses these ports then you will need to specify alternative ports using the <code>port</code> and <code>securePort</code> options, for example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/otp_setup.html">otp_setup</a></span>(<span class="dt">otp =</span> path_otp, <span class="dt">dir =</span> path_data, <span class="dt">port =</span> <span class="dv">8801</span>, <span class="dt">securePort =</span> <span class="dv">8802</span>)</a></code></pre></div>
<p>It should only take a minute or two for OTP to load the graph and start the Grizzly server. If all has worked you should see the message: <code>OTP is ready to use</code> and R will open your web browser at the OTP.</p>
<p>You can also access the web interface using the URL: <a href="http://localhost:8080" class="uri">http://localhost:8080</a>. <strong>Note:</strong> The web interface does not work correctly in Internet Explorer - use Firefox or Chrome. You can now zoom into the Isle of Wight area and request a route by setting an origin and a destination directly on the map (by right-clicking your mouse) and you can specify travel dates, times and modes using the ‘Trip Options’ window (see Figure ). You can change the background map from the layer stack icon at the top right.</p>
<div class="figure" style="text-align: center">
<img src="images/otpwebgui.jpg" alt="\label{fig:otpgui}OTP Web GUI"><p class="caption">
OTP Web GUI
</p>
</div>
</div>
<div id="connecting-to-the-otp-from-r" class="section level2">
<h2 class="hasAnchor">
<a href="#connecting-to-the-otp-from-r" class="anchor"></a>Connecting to the OTP from R</h2>
<p>Now you have the OTP running on your computer you can let R connect to the OTP.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">otpcon &lt;-<span class="st"> </span><span class="kw"><a href="../reference/otp_connect.html">otp_connect</a></span>()</a></code></pre></div>
<p>The connection is created and tested, a message will be returned saying if the connection exists or not.</p>
<p>If you have not used the default settings, such as a different <code>port</code> you can speficy those settings in <code><a href="../reference/otp_connect.html">otp_connect()</a></code></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">otpcon &lt;-<span class="st"> </span><span class="kw"><a href="../reference/otp_connect.html">otp_connect</a></span>(<span class="dt">hostname =</span>  <span class="st">"localhost"</span>, <span class="dt">router =</span> <span class="st">"default"</span>, <span class="dt">port =</span> <span class="dv">8801</span>)</a></code></pre></div>
<p><code><a href="../reference/otp_connect.html">otp_connect()</a></code> creates an OTP connection object which will allow R to connect to the OTP.</p>
</div>
<div id="getting-a-route-from-the-otp" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-a-route-from-the-otp" class="anchor"></a>Getting a route from the OTP</h2>
<p>Now we can use R to get a route from the OTP. OTP accepts pairs of longitude/latitude coordinates for a <code>fromPlace</code> (start of the journey) and <code>toPlace</code> (end of the journey).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">route &lt;-<span class="st"> </span><span class="kw"><a href="../reference/otp_plan.html">otp_plan</a></span>(otpcon, <span class="dt">fromPlace =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="fl">1.17502</span>, <span class="fl">50.64590</span>), <span class="dt">toPlace =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="fl">1.15339</span>, <span class="fl">50.72266</span>))</a></code></pre></div>
<p>If you have the <code>tmap</code> package installed you can view the route using.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"tmap"</span>)  <span class="co"># Only needed if you don't have tmap</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tmap)             <span class="co"># Load the tmap package</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">tmap_mode</span>(<span class="st">"view"</span>)         <span class="co"># Set tmap to interative viewing</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">qtm</span>(sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_zm">st_zm</a></span>(route))     <span class="co"># Plot the route on a map</span></a></code></pre></div>
<p>Notice the use of <code><a href="https://www.rdocumentation.org/packages/sf/topics/st_zm">sf::st_zm(route)</a></code> this is because <code>tmap</code> does not currently support XYZ coordinates.</p>
</div>
<div id="stopping-the-otp" class="section level2">
<h2 class="hasAnchor">
<a href="#stopping-the-otp" class="anchor"></a>Stopping the OTP</h2>
<p>As the OTP is running in Java it will conitune to run after you close R.</p>
<p>You can stop the OTP running using the command. <strong>NOTE: This will stop all running JAVA applications!</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/otp_stop.html">otp_stop</a></span>()</a></code></pre></div>
<p>Congratulations, you now have your own multi-modal router planner!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#building-an-otp-graph">Building an OTP Graph</a></li>
      <li><a href="#launch-otp-and-load-the-graph">Launch OTP and load the graph</a></li>
      <li><a href="#connecting-to-the-otp-from-r">Connecting to the OTP from R</a></li>
      <li><a href="#getting-a-route-from-the-otp">Getting a route from the OTP</a></li>
      <li><a href="#stopping-the-otp">Stopping the OTP</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Marcus Young, Malcolm Morgan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
